<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REYZ4YOU - CYBER CORE V5.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="config.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon-blue: #00f3ff; --neon-purple: #bc13fe; --dark-bg: #05060f; }
        body {
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            color: white; font-family: 'Rajdhani', sans-serif;
            min-height: 100vh; margin: 0; display: flex; justify-content: center; align-items: center;
        }
        .app-wrapper { width: 100%; max-width: 380px; padding: 20px; display: flex; flex-direction: column; gap: 20px; z-index: 10; }
        .cyber-card {
            border: 2px solid var(--neon-blue);
            background: rgba(10, 11, 30, 0.95);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
            clip-path: polygon(0 0, 100% 0, 100% 95%, 95% 100%, 0 100%);
            padding: 24px; width: 100%;
        }
        .step-content { display: none !important; }
        .step-content.active { display: block !important; }
        .neon-text { font-family: 'Orbitron', sans-serif; text-shadow: 0 0 8px var(--neon-blue); }
        .neon-btn {
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple));
            clip-path: polygon(5% 0, 100% 0, 100% 80%, 95% 100%, 0 100%, 0 20%);
            font-weight: bold; transition: 0.3s; color: white;
        }
        #qrisFrame { width: 100%; height: 480px; border: none; border-radius: 8px; background: white; }
        .loader {
            width: 30px; height: 30px;
            border: 3px solid rgba(0, 243, 255, 0.1); border-top-color: var(--neon-blue);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="app-wrapper">
        <div class="text-center mb-4">
            <h1 class="text-4xl font-black neon-text italic text-cyan-400">REYZ<span class="text-purple-500">4YOU</span></h1>
            <p class="text-[8px] tracking-[0.4em] text-gray-500 font-bold uppercase mt-1">Automated Provisioning System</p>
        </div>

        <div id="step1" class="step-content active cyber-card">
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2 text-cyan-400">
                <span class="w-1 h-5 bg-cyan-400 block"></span> AUTH_IDENTIFY
            </h2>
            <div class="mb-6">
                <label class="text-[10px] text-cyan-500 font-bold uppercase ml-1">Username</label>
                <input type="text" id="userInput" class="w-full bg-black/60 border border-cyan-500/30 p-3 rounded font-mono text-cyan-300 outline-none focus:border-cyan-400" placeholder="reyz_cloud">
            </div>
            <button onclick="toStep2()" class="w-full neon-btn py-3 text-sm uppercase">Next Step</button>
        </div>

        <div id="step2" class="step-content cyber-card">
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2 text-purple-400">
                <span class="w-1 h-5 bg-purple-400 block"></span> RESOURCE_ALLOC
            </h2>
            <div id="ramList" class="space-y-2 max-h-80 overflow-y-auto pr-1"></div>
            <button onclick="switchStep(1)" class="w-full mt-4 text-[10px] text-gray-600 font-bold uppercase tracking-widest text-center">‚Üê Back</button>
        </div>

        <div id="step3" class="step-content cyber-card text-center !p-3">
            <h2 class="text-sm font-bold mb-3 text-orange-400 uppercase italic">Scan QRIS</h2>
            <div class="rounded-lg border border-cyan-500/20 overflow-hidden mb-3 bg-white">
                <iframe id="qrisFrame" src=""></iframe>
            </div>
            <div class="bg-black/40 p-3 border-y border-white/5 mb-3">
                <p class="text-xl font-bold text-white font-mono">IDR <span id="priceDisplay"></span></p>
            </div>
            <div class="flex flex-col items-center gap-2">
                <div class="loader"></div>
                <p class="text-[9px] text-cyan-400 animate-pulse font-bold uppercase">Awaiting Payment...</p>
                <p class="text-[8px] text-gray-600 italic">Otomatis Terdeteksi</p>
            </div>
        </div>

        <div id="step4" class="step-content cyber-card">
            <div class="text-center mb-6">
                <div class="inline-block p-2 bg-green-500/10 rounded-full mb-2 border border-green-500/20">
                    <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-black neon-text text-green-400 italic">SERVER DEPLOYED</h2>
            </div>

            <div id="accBox" class="hidden space-y-4">
                <div class="bg-black/80 border border-white/5 rounded-xl p-4 space-y-4 shadow-2xl">
                    <div class="group">
                        <label class="text-[9px] text-cyan-500 font-bold tracking-widest uppercase mb-1 block">Panel_URL</label>
                        <div class="flex items-center gap-2 bg-white/5 p-2 rounded-lg border border-white/10">
                            <span id="resDomain" class="flex-1 font-mono text-[9px] text-gray-300 truncate"></span>
                            <button onclick="copy('resDomain')" class="text-cyan-400 uppercase text-[9px] font-bold">Copy</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div class="group">
                            <label class="text-[9px] text-purple-500 font-bold tracking-widest uppercase mb-1 block">User_ID</label>
                            <div class="bg-white/5 p-2 rounded-lg border border-white/10 relative">
                                <span id="resUser" class="font-mono text-xs text-white block truncate"></span>
                                <button onclick="copy('resUser')" class="absolute top-1 right-1 text-[7px] text-purple-400 uppercase">CPY</button>
                            </div>
                        </div>
                        <div class="group">
                            <label class="text-[9px] text-yellow-500 font-bold tracking-widest uppercase mb-1 block">Pass_Key</label>
                            <div class="bg-white/5 p-2 rounded-lg border border-white/10 relative">
                                <span id="resPass" class="font-mono text-xs text-white block truncate"></span>
                                <button onclick="copy('resPass')" class="absolute top-1 right-1 text-[7px] text-yellow-400 uppercase">CPY</button>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="loginBtn" class="w-full neon-btn py-4 text-sm">LOGIN TO PANEL</button>
            </div>

            <div id="creatingText" class="py-10 flex flex-col items-center">
                <div class="loader mb-3"></div>
                <p class="text-cyan-400 font-bold italic animate-pulse text-[10px] uppercase">Installing Core Logic...</p>
            </div>
        </div>
    </div>

    <script>
        const MY_PAKASIR_API = "URaa2XAwEHwXrO0LTZcFUfLBozUQqdON";
        let order = { username: '', ram: '', disk: 0, cpu: 0, price: 0, orderId: '' };
        let timer;

        function switchStep(n) {
            document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');
        }

        function toStep2() {
            const val = document.getElementById('userInput').value.trim().toLowerCase().replace(/\s/g, '');
            if(val.length < 3) return alert("Min. 3 chars");
            order.username = val;
            const list = document.getElementById('ramList');
            list.innerHTML = '';
            CONFIG.RAM_OPTIONS.forEach(opt => {
                list.innerHTML += `<button onclick="startPay('${opt.name}', ${opt.price}, ${opt.disk}, ${opt.cpu})" class="w-full flex justify-between items-center p-4 bg-black/40 border border-white/5 hover:border-cyan-400 transition-all rounded mb-2">
                    <div><p class="font-bold text-white italic">RAM ${opt.name}</p><p class="text-[8px] text-gray-600 uppercase">C:${opt.cpu}% | D:${opt.disk}MB</p></div>
                    <span class="font-bold text-cyan-400 text-sm">Rp${opt.price.toLocaleString()}</span></button>`;
            });
            switchStep(2);
        }

        function startPay(name, price, disk, cpu) {
            order.ram = name; order.price = price; order.disk = disk; order.cpu = cpu;
            order.orderId = "RZ_" + Date.now().toString(36).toUpperCase();
            document.getElementById('priceDisplay').innerText = price.toLocaleString();
            document.getElementById('qrisFrame').src = `https://app.pakasir.com/pay/${CONFIG.PAKASIR_SLUG}/${price}?order_id=${order.orderId}&qris_only=1`;
            switchStep(3);
            if(timer) clearInterval(timer);
            timer = setInterval(checkStatus, 5000);
        }

        async function checkStatus() {
            try {
                // Perbaikan Endpoint & Header sesuai dokumentasi Pakasir Section E
                let r = await fetch(`https://app.pakasir.com/api/transactiondetail?project=${CONFIG.PAKASIR_SLUG}&order_id=${order.orderId}`, {
                    headers: { 'Authorization': `Bearer ${MY_PAKASIR_API}` }
                });
                let d = await r.json();
                if(d.transaction && d.transaction.status === "completed") {
                    clearInterval(timer);
                    createAcc();
                }
            } catch(e) { console.log("Syncing payment..."); }
        }

        async function createAcc() {
            switchStep(4);
            const pass = order.username + "2026";
            try {
                let u = await fetch(`${CONFIG.PANEL_DOMAIN}/api/application/users`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${CONFIG.PANEL_API_KEY}`, 'Accept': 'application/json' },
                    body: JSON.stringify({ email: `${order.username}@gmail.com`, username: order.username, first_name: order.username, last_name: 'User', language: 'en', password: pass })
                });
                let du = await u.json();
                if(du.errors) throw new Error(du.errors[0].detail);

                await fetch(`${CONFIG.PANEL_DOMAIN}/api/application/servers`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${CONFIG.PANEL_API_KEY}`, 'Accept': 'application/json' },
                    body: JSON.stringify({
                        name: `SRV_${order.username.toUpperCase()}`, user: du.attributes.id, egg: CONFIG.EGG_ID,
                        docker_image: "ghcr.io/parkervcp/yolks:nodejs_20", startup: "npm start",
                        environment: { INST: "npm", USER_UPLOAD: "0", AUTO_UPDATE: "0", CMD_RUN: "npm start" },
                        limits: { memory: order.ram === 'UNLIMITED' ? 0 : parseInt(order.ram) * 1024, swap: 0, disk: order.disk, io: 500, cpu: order.cpu },
                        feature_limits: { databases: 1, backups: 1, allocations: 1 },
                        deploy: { locations: [CONFIG.LOC_ID], dedicated_ip: false, port_range: [] }
                    })
                });

                document.getElementById('resDomain').innerText = CONFIG.PANEL_DOMAIN;
                document.getElementById('resUser').innerText = order.username;
                document.getElementById('resPass').innerText = pass;
                document.getElementById('loginBtn').onclick = () => window.open(CONFIG.PANEL_DOMAIN, '_blank');
                document.getElementById('creatingText').classList.add('hidden');
                document.getElementById('accBox').classList.remove('hidden');
            } catch(e) { document.getElementById('creatingText').innerHTML = `<p class="text-red-500 text-[9px] text-center font-bold">ERROR: ${e.message}</p>`; }
        }

        function copy(id) {
            const t = document.getElementById(id).innerText;
            navigator.clipboard.writeText(t);
            alert("Copied to clipboard!");
        }
    </script>
</body>
</html>        </div>

        <div id="step3" class="step-content cyber-card text-center !p-3">
            <h2 class="text-sm font-bold mb-3 text-orange-400 uppercase italic">Scan QRIS Below</h2>
            <div class="rounded-lg border border-cyan-500/20 overflow-hidden mb-3">
                <iframe id="qrisFrame" src=""></iframe>
            </div>
            <div class="bg-black/40 p-3 border-y border-white/5 mb-3">
                <p class="text-xl font-bold text-white font-mono">IDR <span id="priceDisplay"></span></p>
            </div>
            <div class="flex flex-col items-center gap-2">
                <div class="loader"></div>
                <p class="text-[9px] text-cyan-400 animate-pulse font-bold uppercase">Awaiting Payment...</p>
                <button onclick="checkStatus()" class="text-[8px] text-gray-700 uppercase mt-2">[ Sync Manual ]</button>
            </div>
        </div>

        <div id="step4" class="step-content cyber-card">
            <div class="text-center mb-6">
                <h2 class="text-xl font-black neon-text text-green-400 italic">DEPLOYED</h2>
                <div class="h-[1px] w-full bg-green-500/20 mt-2"></div>
            </div>
            <div id="accBox" class="hidden space-y-4">
                <div class="bg-black/50 border border-white/5 rounded-lg p-4 space-y-3">
                    <div>
                        <label class="text-[8px] text-cyan-500 font-bold uppercase">Panel_Link</label>
                        <div class="flex gap-2 items-center bg-white/5 p-2 rounded border border-white/10">
                            <span id="resDomain" class="flex-1 text-[9px] truncate"></span>
                            <button onclick="copy('resDomain')" class="text-cyan-400 text-[9px] font-bold">COPY</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-[8px] text-purple-500 font-bold uppercase">User</label>
                            <div class="bg-white/5 p-2 rounded border border-white/10 relative">
                                <span id="resUser" class="text-xs font-bold block truncate"></span>
                                <button onclick="copy('resUser')" class="absolute top-1 right-1 text-[7px] text-purple-400">CPY</button>
                            </div>
                        </div>
                        <div>
                            <label class="text-[8px] text-yellow-500 font-bold uppercase">Pass</label>
                            <div class="bg-white/5 p-2 rounded border border-white/10 relative">
                                <span id="resPass" class="text-xs font-bold block truncate"></span>
                                <button onclick="copy('resPass')" class="absolute top-1 right-1 text-[7px] text-yellow-400">CPY</button>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="loginBtn" class="w-full neon-btn py-4 text-sm shadow-lg">ENTER TERMINAL</button>
            </div>
            <div id="creatingText" class="py-10 flex flex-col items-center">
                <div class="loader mb-3"></div>
                <p class="text-cyan-400 font-bold italic animate-pulse text-[10px]">CREATING INSTANCE...</p>
            </div>
        </div>
    </div>

    <script>
        let order = { username: '', ram: '', disk: 0, cpu: 0, price: 0, orderId: '' };
        let timer;

        function switchStep(n) {
            // Hapus class 'active' dari SEMUA step
            document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
            // Tambahkan 'active' hanya ke step yang dituju
            document.getElementById('step' + n).classList.add('active');
        }

        function toStep2() {
            const val = document.getElementById('userInput').value.trim().toLowerCase().replace(/\s/g, '');
            if(val.length < 3) return alert("Min. 3 chars.");
            order.username = val;
            const list = document.getElementById('ramList');
            list.innerHTML = '';
            CONFIG.RAM_OPTIONS.forEach(opt => {
                list.innerHTML += `<button onclick="startPay('${opt.name}', ${opt.price}, ${opt.disk}, ${opt.cpu})" class="w-full flex justify-between items-center p-4 bg-black/40 border border-white/5 hover:border-cyan-400 transition-all rounded text-left">
                    <div><p class="font-bold text-white italic">RAM ${opt.name}</p><p class="text-[8px] text-gray-600 uppercase">C:${opt.cpu}% | D:${opt.disk}MB</p></div>
                    <span class="font-bold text-cyan-400 text-sm">Rp${opt.price.toLocaleString()}</span></button>`;
            });
            switchStep(2);
        }

        function startPay(name, price, disk, cpu) {
            order.ram = name; order.price = price; order.disk = disk; order.cpu = cpu;
            order.orderId = "RZ_" + Date.now().toString(36).toUpperCase();
            document.getElementById('priceDisplay').innerText = price.toLocaleString();
            document.getElementById('qrisFrame').src = `https://app.pakasir.com/pay/${CONFIG.PAKASIR_SLUG}/${price}?order_id=${order.orderId}&qris_only=1`;
            switchStep(3);
            if(timer) clearInterval(timer);
            timer = setInterval(checkStatus, 5000);
        }

        async function checkStatus() {
            try {
                let r = await fetch(`https://app.pakasir.com/api/check-status/${order.orderId}`);
                let j = await r.json();
                if(j.paid || j.status === 'success') { clearInterval(timer); createAcc(); }
            } catch(e){}
        }

        async function createAcc() {
            switchStep(4);
            const pass = order.username + "2546";
            try {
                let u = await fetch(`${CONFIG.PANEL_DOMAIN}/api/application/users`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${CONFIG.PANEL_API_KEY}`, 'Accept': 'application/json' },
                    body: JSON.stringify({ email: `${order.username}@gmail.com`, username: order.username, first_name: order.username, last_name: 'Cyber', language: 'en', password: pass })
                });
                let du = await u.json();
                if(du.errors) throw new Error(du.errors[0].detail);

                await fetch(`${CONFIG.PANEL_DOMAIN}/api/application/servers`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${CONFIG.PANEL_API_KEY}`, 'Accept': 'application/json' },
                    body: JSON.stringify({
                        name: `NODE_${order.username.toUpperCase()}`, user: du.attributes.id, egg: CONFIG.EGG_ID,
                        docker_image: "ghcr.io/parkervcp/yolks:nodejs_20", startup: "npm start",
                        environment: { INST: "npm", USER_UPLOAD: "0", AUTO_UPDATE: "0", CMD_RUN: "npm start" },
                        limits: { memory: order.ram === 'UNLIMITED' ? 0 : parseInt(order.ram) * 1024, swap: 0, disk: order.disk, io: 500, cpu: order.cpu },
                        feature_limits: { databases: 1, backups: 1, allocations: 1 },
                        deploy: { locations: [CONFIG.LOC_ID], dedicated_ip: false, port_range: [] }
                    })
                });

                document.getElementById('resDomain').innerText = CONFIG.PANEL_DOMAIN;
                document.getElementById('resUser').innerText = order.username;
                document.getElementById('resPass').innerText = pass;
                document.getElementById('loginBtn').onclick = () => window.open(CONFIG.PANEL_DOMAIN, '_blank');
                document.getElementById('creatingText').classList.add('hidden');
                document.getElementById('accBox').classList.remove('hidden');
            } catch(e) { document.getElementById('creatingText').innerHTML = `<span class="text-red-500 text-[10px] uppercase font-bold">Error: ${e.message}</span>`; }
        }

        function copy(id) {
            const t = document.getElementById(id).innerText;
            navigator.clipboard.writeText(t);
            alert("Copied!");
        }
        function backTo(n) { if(timer) clearInterval(timer); switchStep(n); }
    </script>
</body>
</html>
